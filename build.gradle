/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.8/userguide/java_library_plugin.html
 */

buildscript {
    repositories {
        mavenCentral()
    }
    dependencies {
        classpath 'com.adaptc.gradle:nexus-workflow:0.6'
        classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.0'
    }
}

plugins {
    id 'net.researchgate.release' version '2.6.0'
    id 'java-library'
    id "org.jetbrains.kotlin.jvm" version '1.2.50'
    id 'org.jetbrains.dokka' version '0.9.17'
    id 'maven-publish'
    id 'maven'
    id 'signing'
}


apply plugin: 'org.junit.platform.gradle.plugin'

junitPlatform {
    filters {
        engines {
            include 'spek'
        }
    }
}

ext.kotlin_version = '1.2.50'
ext.weka_version = '3.8.2'
ext.dokka_version = '0.9.17'
ext.kluent_version = '1.38'
ext.spek_version = '1.1.5'


// Define project dependencies
dependencies {
    compile "nz.ac.waikato.cms.weka:weka-stable:$weka_version"
    compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"

    testImplementation "org.jetbrains.kotlin:kotlin-test"
    testImplementation "org.jetbrains.kotlin:kotlin-test-junit"
//    testImplementation 'junit:junit:4.12'

    testCompile "org.jetbrains.kotlin:kotlin-reflect:$kotlin_version"
    testCompile ("org.jetbrains.spek:spek-api:$spek_version") {
        exclude group: 'org.jetbrains.kotlin'
    }
    testCompile ("org.jetbrains.spek:spek-subject-extension:$spek_version") {
        exclude group: 'org.jetbrains.kotlin'
    }
    testCompile "org.jetbrains.spek:spek-subject-extension:$spek_version"
    testRuntime ("org.jetbrains.spek:spek-junit-platform-engine:$spek_version") {
        exclude group: 'org.junit.platform'
        exclude group: 'org.jetbrains.kotlin'
    }

    // Assertion framework
    testImplementation "org.amshove.kluent:kluent:$kluent_version"
}

// In this section you declare where to find the dependencies of your project
repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
    mavenCentral()
    maven { url "http://dl.bintray.com/jetbrains/spek" }
}

// Dokka setup
dokka {
    outputFormat = 'gfm'
    outputDirectory = "$buildDir/javadoc"

    externalDocumentationLink {
        // Root URL of the generated documentation to link with. The trailing slash is required!
        url = new URL("http://weka.sourceforge.net/doc.stable/")
    }

    // The list of files or directories containing sample code (referenced with @sample tags)
    samples = ['src/samples/com/github/slang03/wekakt/extensions/InstanceSamples.kt',
               'src/samples/com/github/slang03/wekakt/extensions/InstancesSamples.kt',
               'src/samples/com/github/slang03/wekakt/extensions/AttributeSamples.kt',
               'src/samples/com/github/slang03/wekakt/extensions/ClassifierSamples.kt',
               'src/samples/com/github/slang03/wekakt/extensions/ClustererSamples.kt',
               'src/samples/com/github/slang03/wekakt/extensions/OptionHandlerSamples.kt',
    ]
}

task dokkaJavadoc(type: org.jetbrains.dokka.gradle.DokkaTask) {
    outputFormat = 'jekyll'
    outputDirectory = javadoc.destinationDir
    inputs.dir 'src/main/kotlin'
}

task javadocJar(type: Jar, dependsOn: dokkaJavadoc) {
    classifier = 'javadoc'
    from javadoc.destinationDir
}

task copyDocs(type: Copy) {
    from "$buildDir/docs/javadoc"
    into 'docs'
}

copyDocs.shouldRunAfter javadoc

task sourceJar(type: Jar) {
    from sourceSets.main.allJava
    classifier "sources"
}

// Publishing task via maven-publish
publishing {
    publications {
        mavenJava(MavenPublication) {
            from components.java
            artifact sourceJar
            artifact javadocJar

            groupId 'com.github.slang03'
            artifactId 'weka-kt'
            version project.version.replace("-SNAPSHOT","")

            pom {
                name = "weka-kt"
                description = "Kotlin Extensions for Weka."
                url = "http://www.github.com/slang03/weka-kt"
                licenses {
                    license {
                        name = "GNU General Public License 3"
                        url = "http://www.gnu.org/licenses/gpl-3.0.txt"
                    }
                }
                developers {
                    developer {
                        id = "slang03"
                        name = "Steven Lang"
                        email = "steven.lang.mz@gmail.com"
                    }
                }
                scm {
                    connection = "scm:git:https://github.com/slang03/weka-kt"
                    developerConnection = "scm:git:https://github.com/slang03/weka-kt"
                    url = "https://github.com/slang03/weka-kt"
                }
            }
        }
    }

    repositories {
        maven {
            url "https://oss.sonatype.org/service/local/staging/deploy/maven2"

            credentials {
                username = project.nexusUsername
                password = project.nexusPassword
            }
        }
    }
}

// Signing task
signing {
    sign publishing.publications.mavenJava
}
